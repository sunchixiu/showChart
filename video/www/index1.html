<!doctype  html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <title>全屏问题</title>
    <link href="css/style.css?v=1.02" rel="stylesheet" type="text/css">
    <style type="text/css">

        body div.videobox{
            width: 100%;
        }

        body div.videobox video.video
        {
            width: 100%;
            height: 100%;
        }

        :-webkit-full-screen {

        }

        :-moz-full-screen {

        }

        :-ms-fullscreen {

        }

        :-o-fullscreen {

        }

        :full-screen {

        }

        :fullscreen {
            transform: rotate(90deg);
        }

        :-webkit-full-screen video {
            transform: rotate(90deg);
            /*width: 100%;*/
            /*height: 100%;*/
        }
        :-moz-full-screen video{
            transform: rotate(90deg);
            /*width: 100%;*/
            /*height: 100%;*/
        }
        html,body{height: 100%;}
    </style>
</head>
<body>


<div id="videobox" style="width: 100%; height: 100%;">

    <!--<video controls="controls" id="video" src="http://images.sohu.com/ytv/SH/Coke/64036020120714021103.mp4" style="width: 100%; position: absolute; top: 0; left: 0; transform-origin:0 0; transition: 0.1s all ease; background: #000;" onwebkitfullscreenchange="ifFullscreen();">-->
        <video controls="controls" id="video" src="test_video.mp4" style="width: 100%; position: absolute; top: 0; left: 0; transform-origin:0 0; transition: 0.1s all ease; background: #000;" onwebkitfullscreenchange="ifFullscreen();">
    </video>
    <button id="fullScreenBtn" style="margin-top: 300px;">全屏</button>
    <div style="width: 100%; height: 500px; background: #eee;"></div>
</div>


<script type="text/javascript">

    //反射調用
    var invokeFieldOrMethod = function(element, method)
    {
        var usablePrefixMethod;
        ["webkit", "moz", "ms", "o", ""].forEach(function(prefix) {
            if (usablePrefixMethod) return;
            if (prefix === "") {
                // 无前缀，方法首字母小写
                method = method.slice(0,1).toLowerCase() + method.slice(1);
            }
            var typePrefixMethod = typeof element[prefix + method];
            if (typePrefixMethod + "" !== "undefined") {
                if (typePrefixMethod === "function") {
                    usablePrefixMethod = element[prefix + method]();
                } else {
                    usablePrefixMethod = element[prefix + method];
                }
            }
        });

        return usablePrefixMethod;
    };

    //進入全屏
    function launchFullscreen(element)
    {
        //此方法不可以在異步任務中執行，否則火狐無法全屏
        if(element.webkitRequestFullscreen)
        {
            element.style.transform = 'rotate(90deg) translate(0px,-'+screen.availWidth+'px)';
            element.style.width = screen.availHeight + 'px';
            element.style.height = screen.availWidth + 'px';
//            element.webkitRequestFullScreen();
        }else{
            var docHtml  = document.documentElement;
            var docBody  = document.body;
            var videobox  = document.getElementById('videobox');
            var  cssText = 'width:100%;height:100%;overflow:hidden;';
            docHtml.style.cssText = cssText;
            docBody.style.cssText = cssText;
            videobox.style.cssText = cssText+';'+'margin:0px;padding:0px;';
            document.IsFullScreen = true;

        }
    }
    //退出全屏
    function exitFullscreen()
    {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        } else if(document.oRequestFullscreen){
            document.oCancelFullScreen();
        }else if (document.webkitExitFullscreen){
            document.webkitExitFullscreen();
        }else{
            var docHtml  = document.documentElement;
            var docBody  = document.body;
            var videobox  = document.getElementById('videobox');
            docHtml.style.cssText = "";
            docBody.style.cssText = "";
            docHtml.style.transform = 'rotate(90deg)';
            docBody.style.transform = 'rotate(90deg)';
            videobox.style.cssText = "";
            document.IsFullScreen = false;
        }
    }
    document.getElementById('fullScreenBtn').addEventListener('click',function(){
        launchFullscreen(document.getElementById('video'));
        window.setTimeout(function exit(){
//檢查瀏覽器是否處於全屏
            if(invokeFieldOrMethod(document,'FullScreen') || invokeFieldOrMethod(document,'IsFullScreen') || document.IsFullScreen)
            {
                exitFullscreen();
            }
        },5*1000);
    },false);

//    function ifFullscreen(){
//        var oVideo = document.getElementById('video');
//        var oBox = document.getElementById('videobox');
//        if(oVideo.offsetHeight == screen.height){
//            oVideo.style.transform = 'rotate(0deg)';
//            oVideo.style.webkitTransform = 'rotate(90deg)';
//        }else{
//            oVideo.style.transform = 'rotate(90deg)';
//        }
//    };

    function ifFullscreen(){
//        var oVideo = document.getElementById('video');
//        var oBox = document.getElementById('videobox');
//        if (window.orientation == 180 || window.orientation==0) {
//            oVideo.style.transform = 'rotate(90deg)';
//            oVideo.style.webkitTransform = 'rotate(90deg)';
//        }
//        if(window.orientation == 90 || window.orientation == -90) {
//            oVideo.style.transform = 'rotate(0deg)';
//        }
    };


</script>
</body>

</html>